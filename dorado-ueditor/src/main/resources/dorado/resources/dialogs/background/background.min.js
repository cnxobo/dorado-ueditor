(function(){var h=editor.queryCommandValue("background");window.onload=function(){c();b();i(f)};function c(){var k=$G("tabHeads").children;for(var j=0;j<k.length;j++){domUtils.on(k[j],"click",function(n){var m=n.target||n.srcElement;for(var l=0;l<k.length;l++){if(k[l]==m){k[l].className="focus";$G(k[l].getAttribute("data-content-id")).style.display="block"}else{k[l].className="";$G(k[l].getAttribute("data-content-id")).style.display="none"}}})}}function b(){var n=editor.queryCommandValue("background");if(n){var m=n["background-color"],j=n["background-repeat"]||"repeat",l=n["background-image"]||"",o=n["background-position"]||"center center",p=o.split(" "),r=parseInt(p[0])||0,q=parseInt(p[1])||0;if(j=="no-repeat"&&(r||q)){j="self"}l=l.match(/url[\s]*\(([^\)]*)\)/);l=l?l[1]:"";e("colored",m,l,j,r,q)}else{e()}var k=function(){e();a()};domUtils.on($G("nocolorRadio"),"click",a);domUtils.on($G("coloredRadio"),"click",k);domUtils.on($G("url"),"keyup",function(){if($G("url").value&&$G("alignment").style.display=="none"){utils.each($G("repeatType").children,function(s){s.selected=("repeat"==s.getAttribute("value")?"selected":false)
})}k()});domUtils.on($G("repeatType"),"change",k);domUtils.on($G("x"),"keyup",a);domUtils.on($G("y"),"keyup",a);g()}function g(){var k=editor,l=$G("colorPicker");var j=new UE.ui.Popup({content:new UE.ui.ColorPicker({noColorText:k.getLang("clearColor"),editor:k,onpickcolor:function(n,m){e("colored",m);a();UE.ui.Popup.postHide()},onpicknocolor:function(n,m){e("colored","transparent");a();UE.ui.Popup.postHide()}}),editor:k,onhide:function(){}});domUtils.on(l,"click",function(){j.showAnchor(this)});domUtils.on(document,"mousedown",function(m){var n=m.target||m.srcElement;UE.ui.Popup.postHide(n)});domUtils.on(window,"scroll",function(){UE.ui.Popup.postHide()})}function i(j){ajax.request(editor.options.imageManagerUrl,{timeout:100000,action:"get",onsuccess:function(k){var l=k.responseText.split("ue_separate_ue");if(l.length&&l[0]==""){l.shift()}if(l.length&&l[l.length-1]==""){l.pop()}j(l.length?l:lang.noUploadImage)},onerror:function(){j(lang.imageLoadError)}})}function f(j){var k=$G("imageList");
if(utils.isArray(j)&&j){utils.each(j,function(n,m){var l=document.createElement("img"),o=document.createElement("div");o.appendChild(l);o.style.display="none";k.appendChild(o);domUtils.on(l,"click",function(t){var s=t.target||t.srcElement,p=k.childNodes;e("nocolor",null,"");for(var q=0,r;r=p[q++];){if(r.firstChild==s&&!r.firstChild.getAttribute("selected")){r.firstChild.setAttribute("selected","true");r.firstChild.style.cssText="filter:alpha(Opacity=50);-moz-opacity:0.5;opacity: 0.5;border:2px solid blue;";e("colored",null,s.getAttribute("src"),"repeat")}else{r.firstChild.removeAttribute("selected");r.firstChild.style.cssText="filter:alpha(Opacity=100);-moz-opacity:1;opacity: 1;border: 2px solid #fff"}}a()});l.onload=function(r){this.parentNode.style.display="";var p=this.width,q=this.height;d(this,95,120,80);this.title=lang.toggleSelect+p+"X"+q};l.setAttribute(m<35?"src":"lazy_src",editor.options.imageManagerPath+n.replace(/\s+|\s+/ig,""));l.setAttribute("_src",editor.options.imageManagerPath+n.replace(/\s+|\s+/ig,""))
})}else{k.innerHTML="&nbsp;&nbsp;"+j}}function d(m,o,r,k){var j=0,q=0,n,l=m.width||r,p=m.height||k;if(l>o||p>o){if(l>=p){if(j=l-o){n=(j/l).toFixed(2);m.height=p-p*n;m.width=o}}else{if(q=p-o){n=(q/p).toFixed(2);m.width=l-l*n;m.height=o}}}}function e(m,k,l,q,j,p){var o=$G("nocolorRadio"),n=$G("coloredRadio");if(m){o.checked=(m=="colored"?false:"checked");n.checked=(m=="colored"?"checked":false)}if(k){domUtils.setStyle($G("colorPicker"),"background-color",k)}if(l||l===""){$G("url").value=l}if(q){utils.each($G("repeatType").children,function(r){r.selected=(q==r.getAttribute("value")?"selected":false)})}if(j||p){$G("x").value=parseInt(j)||0;$G("y").value=parseInt(p)||0}$G("alignment").style.display=n.checked&&$G("url").value?"":"none";$G("custom").style.display=n.checked&&$G("url").value&&$G("repeatType").value=="self"?"":"none"}function a(){if($G("coloredRadio").checked){var k=domUtils.getStyle($G("colorPicker"),"background-color"),l=$G("url").value,m=$G("repeatType").value,j={"background-repeat":"no-repeat","background-position":"center center"};
if(k){j["background-color"]=k}if(l){j["background-image"]="url("+l+")"}if(m=="self"){j["background-position"]=$G("x").value+"px "+$G("y").value+"px"}else{if(m=="repeat-x"||m=="repeat-y"||m=="repeat"){j["background-repeat"]=m}}editor.execCommand("background",j)}else{editor.execCommand("background",null)}}dialog.onok=function(){a();editor.fireEvent("saveScene")};dialog.oncancel=function(){editor.execCommand("background",h)}})();